<div class="item-similarity-recommendation-container">
    <div class="title-info-container">
        <div class="title">Item Similarity Recommendation</div>
        <lucide-icon 
            [img]="Info" 
            class="info-icon"
            appPopup
            [popupTemplate]="modelInfoPopup"
            [popupContext]="{ 
                info_title: info_title, 
                info_description: info_description 
            }"
        ></lucide-icon>
    </div>

    <div class="search-wrapper">
        <app-autocomplete
            [(query)]="searchQuery"
            placeholder="Search movies..."
            [fetchResults]="search"
            (valueSelected)="onMovieSelected($event)"
            class="search-input"
        ></app-autocomplete>

        <lucide-icon
            #searchPopup
            [img]="Search"
            class="search-icon"
            (mousedown)="onSearchClick()"
            appPopup
            [popupTemplate]="searchInfoPopup"
            [popupContext]="{
                info_title: 'Search Movies',
                results: searchResults,
                loading: loadingSearchResults
            }"
        ></lucide-icon>
    </div>

    <div 
        *ngIf="selectedMovie"
        class="selected-movie-display"
    >
        <div class="selected-movie-text-container">
            Selected Movie: 
            <div 
                class="selected-movie-label"
            >
                {{ selectedMovie }}
            </div>
        </div>
        <lucide-icon
            [img]="Trash2"
            size="18"
            (click)="clearSelectedMovie()"
            class="trash-icon"
        ></lucide-icon>
    </div>

    <div class="number-of-recs-container">
        <div 
            class="number-of-recommendations-label"
        >
            Number of Recommendations:&nbsp;
        </div>
        <input 
            [(ngModel)]="numRecommendations" 
            [placeholder]="10" 
            class="standard-input num-recs-input" 
        />
    </div>

    <div class="search-button">
        <div 
            class="standard-button"
            (click)="onRecommend(selectedMovie)"
        >
            Find Recommendations!
        </div>
    </div>

    <app-results 
        *ngIf="movies && movies.length > 0",
        [results]="movies"
    />

</div>  

<ng-template 
    #modelInfoPopup 
    let-info_title="info_title" 
    let-info_description="info_description"
>
    <div class="model-info-popup-title">
        {{ info_title }}
    </div>

    <div class="model-info-popup-description">
        {{ info_description }}
    </div>
</ng-template>

<ng-template
    #searchInfoPopup
    let-info_title="info_title"
    let-results="results"
    let-loading="loading"
>
    <div class="model-info-popup-title">
        {{ info_title }}
    </div>

    <div *ngIf="loading()" class="search-results-loading">
        Loadingâ€¦
    </div>

    <div *ngIf="!loading() && results()?.length === 0" class="search-results-empty">
        No results found.
    </div>

    <div 
        *ngFor="let movie of results()" 
        (click)="onSearchSelect(movie)"
        class="search-result"
    >
        {{ movie }}
    </div>
</ng-template>
